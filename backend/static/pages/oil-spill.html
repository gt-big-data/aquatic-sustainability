<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Oil Spill Prediction Â· Aquatic Sustainability</title>
<link rel="stylesheet" href="../css/styles.css" />
<style>
  :root {
    --modal-bg: #0f0f0f;
    --modal-bg-secondary: #1a1a1a;
    --modal-text: #ffffff;
    --modal-text-muted: #a0a0a0;
    --modal-border: #333333;
    --modal-accent-red: #f87171;
    --modal-accent-orange: #fb923c;
    --modal-accent-green: #4ade80;
  }

  /* Modal Styles - Dark Theme for Oil Spills */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(8px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    animation: fadeIn 0.2s ease-in;
  }

  .modal-overlay.active {
    display: flex;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .modal {
    background: var(--modal-bg);
    border-radius: 16px;
    border: 1px solid var(--modal-border);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8), 0 0 0 1px rgba(255, 255, 255, 0.05);
    width: 90%;
    max-width: 600px;
    max-height: 85vh;
    overflow-y: auto;
    position: relative;
    animation: slideUp 0.3s ease-out;
  }

  @keyframes slideUp {
    from {
      transform: translateY(50px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .modal::-webkit-scrollbar {
    width: 10px;
  }

  .modal::-webkit-scrollbar-track {
    background: var(--modal-bg-secondary);
    border-radius: 10px;
  }

  .modal::-webkit-scrollbar-thumb {
    background: #444;
    border-radius: 10px;
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 24px;
    border-bottom: 1px solid var(--modal-border);
    background-color: var(--modal-bg-secondary);
  }

  .modal-header h2 {
    margin: 0;
    font-size: 22px;
    color: var(--modal-text);
  }

  .modal-close {
    background: none;
    border: none;
    color: var(--modal-text-muted);
    font-size: 32px;
    cursor: pointer;
    line-height: 1;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    transition: all 0.2s;
  }

  .modal-close:hover {
    background-color: rgba(255, 255, 255, 0.1);
    color: var(--modal-text);
  }

  .modal-body {
    padding: 24px;
  }

  .modal-section {
    margin-bottom: 24px;
  }

  .modal-section h3 {
    margin: 0 0 12px 0;
    font-size: 14px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--modal-text-muted);
  }

  .modal-info-item {
    background-color: var(--modal-bg-secondary);
    padding: 12px 16px;
    border-radius: 8px;
    border: 1px solid var(--modal-border);
    margin-bottom: 12px;
  }

  .modal-info-item label {
    display: block;
    font-size: 12px;
    font-weight: 500;
    color: var(--modal-text-muted);
    margin-bottom: 4px;
    text-transform: uppercase;
    letter-spacing: 0.3px;
  }

  .modal-info-item .value {
    font-size: 16px;
    font-weight: 600;
    color: var(--modal-text);
  }

  .modal-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 12px;
  }

  .modal-map-coords {
    font-size: 11px;
    color: var(--modal-text-muted);
    margin-top: 4px;
  }

  .danger {
    color: var(--modal-accent-red) !important;
  }

  .warning {
    color: var(--modal-accent-orange) !important;
  }

  .highlight {
    color: var(--modal-accent-green) !important;
  }
</style>
</head>
<body>
<header class="site-header">
<a class="brand" href="../">
<img src="../assets/images/logo.svg" alt="Aquatic Sustainability logo" class="logo" />
<span class="brand-title">Aquatic Sustainability</span>
</a>
<nav class="top-nav">
<a href="../pages/flood-drought.html">Flood/Drought</a>
<a class="active" href="../pages/oil-spill.html">Oil Spill</a>
<button id="themeToggle" class="btn btn-ghost" aria-label="Toggle theme">ðŸŒ“</button>
<button id="logoutBtn" class="btn btn-outline" style="float:right; margin-left:1em;">Logout</button>
</nav>
</header>


<main class="workspace">
<aside class="sidebar">
<h2 class="sidebar-title">Controls</h2>
<div class="control-group">
<label for="marineZoneSelect">Marine Zone</label>
<select id="marineZoneSelect">
<option value="">Select a zoneâ€¦</option>
<option>North Atlantic</option>
<option>Caribbean</option>
<option>Pacific Northwest</option>
<option>Custom (draw)</option>
</select>
</div>
<div class="control-group">
<label>Overlays</label>
<label class="checkbox"><input type="checkbox" id="overlayTraffic" checked> Ship traffic</label>
<label class="checkbox"><input type="checkbox" id="overlayWind" checked> Wind</label>
<label class="checkbox"><input type="checkbox" id="overlayTemp"> SST</label>
</div>
<div class="control-group">
<label for="confidence">Detection confidence</label>
<input type="range" id="confidence" min="0" max="100" value="70" />
<small><span id="confidenceLabel">70</span>%</small>
</div>
<button id="btnRunModel" class="btn">Run model</button>
</aside>


<!-- Main: map canvas -->
<section class="map-panel">
<div id="map"></div>
</section>


<aside class="details">
<h2 class="sidebar-title">Detections</h2>
<div id="detections" class="annotations">
<p class="muted">Model detections will render here with timestamps and extents.</p>
</div>
</aside>
</main>


<footer class="site-footer">
<small>Oil Spill Prediction Â· Prototype</small>
</footer>

<!-- Modal Popup -->
<div id="spillModal" class="modal-overlay">
  <div class="modal">
    <div class="modal-header">
      <h2>Oil Spill Details</h2>
      <button class="modal-close" aria-label="Close modal">&times;</button>
    </div>
    <div class="modal-body" id="modalContent">
      <!-- Content will be dynamically inserted here -->
    </div>
  </div>
</div>

<script>
  let markerObjects = [];
  let map;

  // Oil spill dummy data
  const oilSpillData = [
    {
      id: 1,
      name: "Gulf of Mexico Incident",
      coordinates: { lat: 28.7378, lng: -88.3831 },
      date: "2024-03-15",
      time: "14:30 UTC",
      amountSpilled: "4,200 barrels",
      amountBarrels: 4200,
      amountLiters: "667,800 L",
      cause: "Pipeline rupture",
      surfaceArea: "45.2 kmÂ²",
      severity: "high",
      affectedArea: "Coastal waters near Louisiana",
      windSpeed: "12 knots NE",
      seaTemp: "22.5Â°C",
      responseStatus: "Active cleanup in progress",
      estimatedDuration: "3-4 weeks"
    },
    {
      id: 2,
      name: "North Atlantic Detection",
      coordinates: { lat: 41.2345, lng: -69.8765 },
      date: "2024-03-18",
      time: "09:15 UTC",
      amountSpilled: "850 barrels",
      amountBarrels: 850,
      amountLiters: "135,150 L",
      cause: "Vessel collision",
      surfaceArea: "12.8 kmÂ²",
      severity: "medium",
      affectedArea: "Open ocean, 45 nm from shore",
      windSpeed: "8 knots SW",
      seaTemp: "18.2Â°C",
      responseStatus: "Containment deployed",
      estimatedDuration: "1-2 weeks"
    },
    {
      id: 3,
      name: "Caribbean Spill Event",
      coordinates: { lat: 18.4789, lng: -64.5432 },
      date: "2024-03-20",
      time: "16:45 UTC",
      amountSpilled: "2,100 barrels",
      amountBarrels: 2100,
      amountLiters: "333,900 L",
      cause: "Tanker hull breach",
      surfaceArea: "28.5 kmÂ²",
      severity: "high",
      affectedArea: "Near Puerto Rico coast",
      windSpeed: "15 knots E",
      seaTemp: "26.8Â°C",
      responseStatus: "Emergency response active",
      estimatedDuration: "2-3 weeks"
    },
    {
      id: 4,
      name: "Pacific Northwest Detection",
      coordinates: { lat: 47.6234, lng: -124.3456 },
      date: "2024-03-22",
      time: "11:20 UTC",
      amountSpilled: "320 barrels",
      amountBarrels: 320,
      amountLiters: "50,880 L",
      cause: "Equipment failure",
      surfaceArea: "5.7 kmÂ²",
      severity: "low",
      affectedArea: "Washington State waters",
      windSpeed: "6 knots W",
      seaTemp: "12.4Â°C",
      responseStatus: "Contained",
      estimatedDuration: "3-5 days"
    },
    {
      id: 5,
      name: "Atlantic Seaboard Incident",
      coordinates: { lat: 35.8976, lng: -75.2341 },
      date: "2024-03-25",
      time: "07:50 UTC",
      amountSpilled: "1,650 barrels",
      amountBarrels: 1650,
      amountLiters: "262,350 L",
      cause: "Illegal discharge",
      surfaceArea: "18.9 kmÂ²",
      severity: "medium",
      affectedArea: "Off North Carolina coast",
      windSpeed: "10 knots N",
      seaTemp: "16.7Â°C",
      responseStatus: "Investigation ongoing",
      estimatedDuration: "1-2 weeks"
    }
  ];

  // Modal functions
  function openModal(spillData) {
    const modal = document.getElementById('spillModal');
    const modalContent = document.getElementById('modalContent');

    const severityClass = spillData.severity === 'high' ? 'danger' :
      spillData.severity === 'medium' ? 'warning' : 'highlight';

    modalContent.innerHTML = `
      <div class="modal-section">
        <h3>Location</h3>
        <div class="modal-info-item">
          <label>Incident Name</label>
          <div class="value">${spillData.name}</div>
        </div>
        <div class="modal-info-item">
          <label>Coordinates</label>
          <div class="value">${spillData.coordinates.lat.toFixed(4)}Â°${spillData.coordinates.lat >= 0 ? 'N' : 'S'}, ${Math.abs(spillData.coordinates.lng).toFixed(4)}Â°${spillData.coordinates.lng >= 0 ? 'E' : 'W'}</div>
          <div class="modal-map-coords">
            Lat: ${spillData.coordinates.lat} | Lng: ${spillData.coordinates.lng}
          </div>
        </div>
        <div class="modal-info-item">
          <label>Affected Area</label>
          <div class="value">${spillData.affectedArea}</div>
        </div>
      </div>

      <div class="modal-section">
        <h3>Incident Details</h3>
        <div class="modal-info-grid">
          <div class="modal-info-item">
            <label>Date Occurred</label>
            <div class="value">${new Date(spillData.date).toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'long',
              day: 'numeric'
            })}</div>
          </div>
          <div class="modal-info-item">
            <label>Time</label>
            <div class="value">${spillData.time}</div>
          </div>
          <div class="modal-info-item">
            <label>Severity</label>
            <div class="value ${severityClass}">${spillData.severity.toUpperCase()}</div>
          </div>
          <div class="modal-info-item">
            <label>Cause</label>
            <div class="value">${spillData.cause}</div>
          </div>
        </div>
      </div>

      <div class="modal-section">
        <h3>Spill Metrics</h3>
        <div class="modal-info-grid">
          <div class="modal-info-item">
            <label>Amount Spilled</label>
            <div class="value ${severityClass}">${spillData.amountSpilled}</div>
            <div style="font-size: 12px; color: var(--modal-text-muted); margin-top: 4px;">(${spillData.amountLiters})</div>
          </div>
          <div class="modal-info-item">
            <label>Surface Area</label>
            <div class="value ${severityClass}">${spillData.surfaceArea}</div>
          </div>
        </div>
      </div>

      <div class="modal-section">
        <h3>Environmental Conditions</h3>
        <div class="modal-info-grid">
          <div class="modal-info-item">
            <label>Wind Speed & Direction</label>
            <div class="value">${spillData.windSpeed}</div>
          </div>
          <div class="modal-info-item">
            <label>Sea Surface Temperature</label>
            <div class="value">${spillData.seaTemp}</div>
          </div>
        </div>
      </div>

      <div class="modal-section">
        <h3>Response Status</h3>
        <div class="modal-info-item">
          <label>Current Status</label>
          <div class="value">${spillData.responseStatus}</div>
        </div>
        <div class="modal-info-item">
          <label>Estimated Cleanup Duration</label>
          <div class="value">${spillData.estimatedDuration}</div>
        </div>
      </div>
    `;

    modal.classList.add('active');
  }

  function closeModal() {
    const modal = document.getElementById('spillModal');
    modal.classList.remove('active');
  }

  // Initialize modal event listeners
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('spillModal');
    const closeBtn = modal.querySelector('.modal-close');

    closeBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => {
      if (e.target === modal) closeModal();
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal.classList.contains('active')) {
        closeModal();
      }
    });
  });

  // Fetch Google Maps API key and initialize map
  fetch("/api/config/maps-key")
    .then(res => res.json())
    .then(data => {
      const apiKey = data.googleMapsApiKey || "DEMO_KEY";
      const script = document.createElement("script");
      script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&callback=initMap`;
      script.async = true;
      document.head.appendChild(script);
    });

  // Initialize Google Map with oil spill markers
  function initMap() {
    const center = { lat: 32.0, lng: -80.0 };
    map = new google.maps.Map(document.getElementById("map"), {
      zoom: 4,
      center: center,
    });

    // Create markers for each oil spill
    oilSpillData.forEach(spill => {
      // Determine marker color based on severity
      let markerIcon = {
        path: google.maps.SymbolPath.CIRCLE,
        scale: 10,
        fillColor: spill.severity === 'high' ? '#ef4444' :
                   spill.severity === 'medium' ? '#f59e0b' : '#22c55e',
        fillOpacity: 0.8,
        strokeColor: '#ffffff',
        strokeWeight: 2
      };

      const marker = new google.maps.Marker({
        position: spill.coordinates,
        map: map,
        title: spill.name,
        icon: markerIcon,
        animation: google.maps.Animation.DROP
      });

      // Store marker reference
      markerObjects.push({ marker: marker, spill: spill });

      // Add click listener to show popup
      marker.addListener('click', () => {
        openModal(spill);
      });

      // Optional: Add info window on hover
      const infoWindow = new google.maps.InfoWindow({
        content: `<div style="padding: 8px;">
                    <strong>${spill.name}</strong><br>
                    <span style="color: ${spill.severity === 'high' ? '#ef4444' :
                                           spill.severity === 'medium' ? '#f59e0b' : '#22c55e'};">
                      ${spill.severity.toUpperCase()} Severity
                    </span><br>
                    ${spill.amountSpilled}<br>
                    <em>Click for details</em>
                  </div>`
      });

      marker.addListener('mouseover', () => {
        infoWindow.open(map, marker);
      });

      marker.addListener('mouseout', () => {
        infoWindow.close();
      });
    });
  }
</script>

<script src="../js/main.js" defer></script>
<script src="../js/pages/oilSpill.js" defer></script>
</body>
</html>
